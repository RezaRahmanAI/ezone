@model dynamic
<div class="input-group">
    <input type="text" class="input-sm form-control input-sm" id="GodownsCode" Name="GodownsCode" value="@ViewBag.GodownsCode" readonly="readonly">
    <span class="input-group-btn">
        <button type="button" class="btn btn-sm btn-info" id="btnGodownPicker"><i class="fa fa-plus-circle" aria-hidden="true"></i>&nbsp;Pick</button>
    </span>
    <input type="text" class="input-sm form-control input-sm" id="GodownsName" Name="GodownsName" value="@ViewBag.GodownsName" readonly="readonly">
    <input type="hidden" class="input-sm form-control input-sm" id="GodownsId" Name="GodownsId" value="@ViewBag.GodownsId" readonly="readonly">
    <input type="hidden" class="input-sm form-control input-sm" id="GodownsConcernName" Name="GodownsConcernName" value="@ViewBag.GodownsConcernName" readonly="readonly">
</div>

<!-- Modal -->
<div class="modal fade bs-example-modal-md" id="GodownsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h5 class="modal-title" id="myModalLabel">Existing Godowns</h5>
            </div>
            <div class="modal-body">
                <div id="Godownstoolbar">
                    @Html.ActionLink("Create new", "Create", "Godown", routeValues: null, htmlAttributes: new { @class = "btn btn-primary btn-sm", target = "_blank" })
                    <span class="text-warning">&nbsp;(Requires reload current page to get new item)</span>
                </div>
                <table id="GodownsTable"
                       data-toolbar="#Godownstoolbar"
                       data-toggle="table"
                       data-search="true"
                       data-click-to-select="true"
                       data-single-select="true"
                       data-detail-view="true"
                       data-pagination="true"
                       data-id-field="Name"
                       data-page-list="[10, 25, 50, 100, ALL]"
                       data-page-size="6"
                       class="table table-responsive table-bordered table-striped" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th data-field="GodownID" class="hidden">
                            </th>
                            <th data-checkbox="true">
                            </th>
                            <th data-field="Code"
                                data-sortable="true">
                                Code
                            </th>
                            <th data-field="Name"
                                data-sorter="sorter"
                                data-sortable="true">
                                Name
                            </th>
                            <th data-field="SisterConcern.Name"
                                data-sorter="sorter"
                                data-sortable="true">
                                Godown Concern Name
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    var $table = $('#GodownsTable');
    $table.on('check.bs.table', function (e, row) {
        $('#GodownsCode').val($.trim(row.Code));
        $('#GodownsName').val($.trim(row.Name));
        $('#GodownsId').val($.trim(row.GodownID));
        $('#GodownsConcernName').val($.trim(row.SisterConcern.Name));



        if ($.trim(row.GodownID) == "") {
            $('#dvNotAllowed').removeClass('disableConcern');
        } else {
            $('#dvNotAllowed').addClass('disableConcern');
        }

        //if ($.trim(row.GodownID) == "")
        //{
        //    $('[id*="_ToConcernID"]').removeAttr("disabled");
        //}
        //else
        //    $('[id*="_ToConcernID"]').attr("disabled", "disabled");


    });
    $table.on('uncheck.bs.table', function (e, row) {
        $('#GodownsCode').val('');
        $('#GodownsName').val('');
        $('#GodownsId').val('');
        $('#GodownsConcernName').val('');
    });

    $(document).on('click', '#btnGodownPicker', function () {
        GetGodownsByConcernID();
    });


    function GetGodownsByConcernID() {
        var $table = $('#GodownsTable');
        var ConcernID = $('select[id*="_ToConcernID"]').val();

        if (ConcernID == "" || ConcernID == undefined) {
            toastr.error("Please Select TO Concern First.");
            return;
        }


        $.ajax({
            type: "GET",
            url: "/Godown/GetGodownsByConcernID/",
            data: { "ConcernID": ConcernID },
            dataType: "json",
            contentType: "application/json ; charset=UTF-8",
            success: function (data) {
                $table.bootstrapTable('load', data);
                $('#GodownsModal').modal('toggle');
            },
            error: function (error) {
                console.log(error.responseText);
            }

        });
    }

</script>
