<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - IMS</title>
    @Styles.Render("~/IMSStyles")
    <link href="~/Content/jquery-ui.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        #btnMakePayment {
            background: #D32165;
            border-color: #D32165;
        }
        
    </style>
</head>



@Scripts.Render("~/IMSPreDOMScripts")
<body>
    <div class="wrapper">
        @if (User.Identity.IsAuthenticated)
        {
            <!-- Sidebar  -->
            <nav id="sidebar">
                <div class="sidebar-header text-center">
                    <h3 id="BrandName1" class="fw-bold">
                        @if (TempData.ContainsKey("ConcernName"))
                        {
                            <text>@TempData.Peek("ConcernName").ToString()</text>
                        }
                    </h3>
                    <strong id="BrandName2" class="text-center">
                        @if (TempData.ContainsKey("ConcernName"))
                        {
                            <text>@TempData.Peek("ConcernName").ToString()</text>
                        }
                    </strong>

                </div>
                <ul class="list-unstyled components">            

                    @Html.Raw(Html.BuildMenuNavigation())
                </ul>
                @Html.Partial("_LoginPartial")
            </nav>
        }
        <!-- Page Content  -->
        <div id="content">
            <div class="container-fluid">
                @if (User.Identity.IsAuthenticated)
                {
                    <nav class="navbar navbar-expand-lg navbar-light bg-light">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-2 col-sm-4">
                                    <div class="menu-button">
                                        <button type="button" id="sidebarCollapse" class="btn btn-primary btn-sm" style="min-width: 35px !important;">
                                            <i class="fa fa-align-left" aria-hidden="true"></i>
                                        </button>
                                        <div class="dashboard">
                                            <a href="@Url.Action("Index", "Home")">
                                                <h4>Dashboard</h4>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <!-- #region Breadcrumb -->
                                    @Html.Raw(Html.BuildBreadcrumbNavigation())
                                    <!-- #endregion -->
                                </div>
                                <div class="col-md-4 col-sm-6 text-left text-danger" style="font-weight: bold" id="expMsg">

                                    @if (TempData.ContainsKey("ExpireMessage"))
                                    {
                                        <div>
                                            @TempData.Peek("ExpireMessage")

                                            <span id="payBtn">
                                                <a href="@Url.Action("Index", "Payment")" class="btn btn-danger btn-sm" id="btnMakePayment">Pay with bKash</a>
                                            </span>

                                        </div>
                                    }
                                </div>
                                <div class="col-md-2 col-sm-2">
                                    <div class="text-right">
                                        <a href="#" class="menu--icon">
                                            <h5 id="UserName"></h5>

                                            <span class="material-symbols-outlined">
                                                person
                                            </span>
                                        </a>
                                        <div class="sub--menu">
                                            <h5 class="text-center" id="UserName2"></h5>
                                            <div class="">
                                                <a class="btn btn-change" href="/Manage/ChangePassword/">
                                                    <i class="fa fa-unlock-alt" aria-hidden="true"></i> Update Password
                                                </a>
                                                <a class="btn btn-logof" href="javascript:document.getElementById('logoutForm').submit()" id="btnLogoff">
                                                    <i class="fa fa-sign-out" aria-hidden="true"></i> Log off
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                }

                @Html.Partial("~/Views/ToastrBuilder/_Toastr.cshtml")
            </div>
            <div class="container-fluid" style="min-height: 65vh;">
                <div id="report"></div>
                @RenderBody()
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-bottom" id="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-5">
                        <p class="pull-left">E-ZONE @DateTime.Today.Year All rights reserved</p>
                    </div>
                    <div class="col-md-3">
                        <p>
                            Copyright © Object Canvas Technology
                        </p>
                    </div>
                    <div class="col-md-4">
                        <div class="pull-right">
                            <ul class="nav nav-pills payments">
                                <li><i class="fa fa-cc-visa"></i></li>
                                <li><i class="fa fa-cc-mastercard"></i></li>
                                <li><i class="fa fa-cc-amex"></i></li>
                                <li><i class="fa fa-cc-paypal"></i></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <div class="modal fade bs-example-modal-sm" id="RemarksModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div id="modalheader" class="modal-header">
                    Remarks
                </div>
                <div id="divRemarks" style="overflow:auto" class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    @Scripts.Render("~/IMSPostDOMScripts")
    @RenderSection("scripts", required: false)
</body>
</html>

<script>
    $(document).on('click', '.btn-remarks', function () {
        var remarks = $(this).data("remarks");
        var header = $(this).data("header");
        ShowRemarks(remarks, header);
    });

    function ShowRemarks(Remarks, header) {
        var message = "";
        if (typeof (Remarks) === "object") {
            Remarks.forEach(function (data, row) {
                message += (row + 1) + ": Mobile: " + data.MobileNumber + " " + data.SmsText + "\n";
            });
        }
        else
            message = Remarks;
        //alert(message);
        $("#divRemarks").text(message);
        $("#modalheader").text(header);
        $("#RemarksModal").modal("show");
    }

    $('form').submit(function () {
        var ClientDateTime = moment().format('DD MMM YYYY hh:mm:ss a');
        $("#ClientDateTime").val(ClientDateTime);
        //alert(ClientDateTime);
    });

    $(document).ready(function () {
        GetClientDateTime();
        $('.ddl2').select2({
            placeholder: "--Select--",
            allowClear: true
        });
    });


    function GetClientDateTime() {
        var ClientDateTime = moment().format('DD MMM YYYY hh:mm:ss a');
        $.ajax({
            url: "/Report/GetClientDateTime/",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({ "ClientDateTime": ClientDateTime }),
            success: function (data) {
                console.log(data);
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    $(document).ready(function () {
       @if (!TempData.ContainsKey("ConcernName")
           || !TempData.ContainsKey("ExpireMessage") == null)   // || (CreateSystemInformationViewModel)Session["SystemInfo"]
       {
           @:GetConcernName();
       }
    });


    function GetConcernName() {
        $.ajax({
            url: "/Report/GetConcernName/",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({ "ClientDateTime": new Date() }),
            success: function (data) {
                $("#BrandName1").text(data.ConcernName);
                $("#BrandName2").text(data.ConcernName);
                $("#expMsg").text(data.expiremsg);
                if (data.expiremsg) {
                    $("#expMsg").append("<a href='/Payment' class='btn btn-danger btn-sm' id='btnMakePayment' style='margin-left:5px'>Make Payment</a>");
                }

                //console.log(data);
            },
            error: function (data) {
                //console.log(data);
            }
        });
    }


    $(document).ready(function () {
        window.setInterval(function () {
            UpdateSMSStatus();
        }, 600000);
    });

    function UpdateSMSStatus() {
        $.ajax({
            url: "@Url.Action("UpdateSMSStaus", "SMSService")",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
                SetCounter(data.length);
                PopulateNotificationContent(data);
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    //// JavaScript to toggle the submenu visibility
    //document.addEventListener("DOMContentLoaded", function () {
    //    var menuIcon = document.querySelector('.menu--icon');
    //    var subMenu = menuIcon.querySelector('.sub--menu');

    //    menuIcon.addEventListener('click', function () {
    //        subMenu.classList.toggle('show');
    //    });

    //    // Close the submenu when clicking outside of it
    //    document.addEventListener('click', function (event) {
    //        if (!menuIcon.contains(event.target)) {
    //            subMenu.classList.remove('show');
    //        }
    //    });
    //});


    document.addEventListener("DOMContentLoaded", function () {
        var menuIcon = document.querySelector('.menu--icon');
        var subMenu = document.querySelector('.sub--menu');

        menuIcon.addEventListener('click', function () {
            subMenu.style.display = (subMenu.style.display === 'block') ? 'none' : 'block';
        });

        document.addEventListener('click', function (event) {
            if (!menuIcon.contains(event.target) && !subMenu.contains(event.target)) {
                subMenu.style.display = 'none';
            }
        });
    });


    $(document).ready(function () {
        GetUserName();
    });

    function GetUserName() {
        $.ajax({
            url: "/Home/getConcernName",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.Status) {
                    $('#UserName').html(data.Name);
                }
                if (data.Status) {
                    $('#UserName2').html(data.Name);
                }
                else {
                    alert("User name not found.");
                }
             
            },
            error: function (err) {
                console.log(err);
            }
        });
    }

</script>
