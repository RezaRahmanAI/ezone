@model IEnumerable<GetProductViewModel>

<style>
    /* Main table container with horizontal scroll */
    .table-responsive-container {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin-bottom: 15px;
    }

    /* Table styling */
    #ProductDetailsTable {
        min-width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

        #ProductDetailsTable thead th {
            text-align: center;
            vertical-align: middle;
            background-color: #0d85bb !important;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 12px 8px;
            white-space: nowrap;
        }

        #ProductDetailsTable tbody td {
            text-align: center;
            vertical-align: middle;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;
        }

        #ProductDetailsTable tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Checkbox column */
        #ProductDetailsTable td:first-child {
            width: 40px;
        }

    /* Search and pagination styling */
    .dataTables_wrapper .dataTables_filter {
        float: right;
        margin-bottom: 15px;
    }

        .dataTables_wrapper .dataTables_filter input {
            margin-left: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            padding: 5px 10px;
        }

    .dataTables_wrapper .dataTables_length {
        float: left;
        margin-bottom: 15px;
    }

    .dataTables_wrapper .dataTables_paginate {
        float: right;
        margin-top: 15px;
    }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 5px 10px;
            margin-left: 2px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

            .dataTables_wrapper .dataTables_paginate .paginate_button.current {
                background: #0d85bb;
                color: white !important;
                border-color: #0d85bb;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
                background: #e9e9e9;
            }

    /* Modal adjustments */
    .modal-body {
        padding: 20px;
    }

    .modal-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #ddd;
    }

    /* Input group styling */
    .input-group {
        margin-bottom: 15px;
    }

    /* Toolbar styling */
    #ProductDetailstoolbar {
        margin-bottom: 15px;
    }

    /* Responsive adjustments */
    @@media (max-width: 768px) {
        .dataTables_wrapper .dataTables_filter,
        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_paginate {
            float: none;
            text-align: center;
        }

            .dataTables_wrapper .dataTables_filter input {
                width: 100%;
                margin-left: 0;
                margin-top: 5px;
            }
    }
</style>

<div class="input-group">
    <input type="text" class="input-sm form-control input-sm" id="ProductDetailsCode" name="ProductDetailsCode" value="@ViewBag.PDetailsCode" readonly="readonly">
    <span class="input-group-btn">
        <button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#ProductDetailsModal">
            <i class="fa fa-plus-circle" aria-hidden="true"></i>&nbsp;Pick
        </button>
    </span>
    <input type="text" class="input-sm form-control input-sm" id="ProductDetailsName" name="ProductDetailsName" value="@ViewBag.PDetailsName" readonly="readonly">
    <input type="hidden" class="input-sm form-control input-sm" id="ProductDetailsId" name="ProductDetailsId" value="@ViewBag.PDetailsId">
    <input type="hidden" class="input-sm form-control input-sm" id="StockDetailsId" name="StockDetailsId" value="@ViewBag.PDetailsStockDetailId">
    <input type="hidden" class="input-sm form-control input-sm" id="ColorsId" name="ColorsId" value="@ViewBag.PDetailsColorId">
    <input type="hidden" class="input-sm form-control input-sm" id="Offer" name="OfferDescription" value="@ViewBag.OfferDescription">
    <input type="hidden" class="input-sm form-control input-sm" id="ProductType" name="ProductType" value="@ViewBag.ProductType">
    <input type="hidden" id="GodownsId" name="ProductType" value="@ViewBag.GodownID">
</div>

<!-- Modal -->
<div class="modal fade bs-example-modal-lg" id="ProductDetailsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document" style="max-width: 95%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title" id="myModalLabel">Existing ProductDetails</h5>
            </div>
            <div class="modal-body">
                <div id="ProductDetailstoolbar">
                    @Html.ActionLink("Create new", "Create", "Product", routeValues: null,
                    htmlAttributes: new { @class = "btn btn-primary btn-sm", target = "_blank" })
                    <span class="text-warning">&nbsp;(Requires reload current page to get new item)</span>
                </div>

                <div class="table-responsive-container">
                    <table id="ProductDetailsTable" class="display table table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th class="hidden">ID</th> <!-- id -->
                                <th class="hidden">PRate</th> <!-- PRate -->
                                <th class="hidden">Product Type</th> <!-- ProductType -->
                                <th></th> <!-- Checkbox -->
                                <th>#</th> <!-- Serial Number -->
                                <th data-field="code" data-sorter="sorter" data-sortable="true">Code</th>
                                <th data-field="name" data-sorter="sorter" data-sortable="true">Name</th>
                                <th data-field="GodownName" data-sorter="sorter" data-sortable="true">Godown</th>
                                <th data-field="colorname" data-sorter="sorter" data-sortable="true">Color</th>
                                <th data-field="category" data-sorter="sorter" data-sortable="true">Category</th>
                                <th class="hidden">Detail ID</th> <!-- detailId -->
                                <th class="hidden">Color ID</th> <!-- colorId -->
                                <th class="hidden">Godown ID</th> <!-- godownId -->
                                <th data-field="imeNo" data-sorter="sorter" data-sortable="true">IME No.</th>
                                <th data-field="mrpRate" data-sorter="sorter" data-sortable="true">MRP Rate</th>
                                <th data-field="preStock" data-sorter="sorter" data-sortable="true">Stock Quantity</th>
                                <th class="hidden">Service</th> <!-- Service -->
                            </tr>
                        </thead>
                    </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

    <script>
    $(document).ready(function () {
        var table = $('#ProductDetailsTable').DataTable({
            processing: true,
            serverSide: true,
            ajax: {
                url: '@Url.Action("GetProductsForSale", "Product")',
                type: 'GET'
            },
            columns: [
                { data: 'ProductId', visible: false },
                { data: 'PRate', visible: false },
                { data: 'ProductType', visible: false },
                {
                    data: null,
                    defaultContent: '<input type="checkbox" class="row-select" />',
                    orderable: false
                },
                {
                    data: null,
                    render: function (data, type, row, meta) {
                        return meta.row + 1;
                    }
                },
                { data: 'ProductCode' },
                { data: 'ProductName' },
                { data: 'GodownName' },
                { data: 'ColorName' },
                { data: 'CategoryName' },
                { data: 'StockDetailsId', visible: false },
                { data: 'ColorId', visible: false },
                { data: 'GodownID', visible: false },
                { data: 'IMENo' },
                { data: 'MRPRate' },
                { data: 'PreStock' },
                { data: 'Service', visible: false }
            ],
            order: [[1, 'asc']],
            lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
            pageLength: 10
        });

        $('#ProductDetailsTable tbody').on('click', 'tr', function () {
            var row = table.row($(this).closest('tr')).data();

            $('#ProductDetailsCode').val($.trim(row.ProductCode));
            $('#ProductDetailsName').val($.trim(row.ProductName));
            $('#StockDetailsId').val($.trim(row.StockDetailsId));
            $('#ColorsId').val($.trim(row.ColorId));
            $('#GodownsId').val($.trim(row.GodownID)).trigger("input");
            $('#SODetail_GodownID').val($.trim(row.GodownID)).trigger("input");
            $('[id*="_IMENo"]').val($.trim(row.IMENo));
            $('[id*="_ColorName"]').val($.trim(row.ColorName));
            $('[id*="_PreviousStock"]').val($.trim(row.PreStock));
            $('[id*="_Quantity"]').val('1');
            $('[id*="_MRPRate"]').val($.trim(row.MRPRate)).trigger("input");
            $('[id*="_OfferDescription"]').text(row.OfferDescription || '');
            $('[id*="_CompressorWarrentyMonth"]').val($.trim(row.CompressorWarrentyMonth));
            $('[id*="_PanelWarrentyMonth"]').val($.trim(row.PanelWarrentyMonth));
            $('[id*="_MotorWarrentyMonth"]').val($.trim(row.MotorWarrentyMonth));
            $('[id*="_SparePartsWarrentyMonth"]').val($.trim(row.SparePartsWarrentyMonth));
            $('[id*="_ServiceWarrentyMonth"]').val($.trim(row.ServiceWarrentyMonth));
            $('[id*="_PRate"]').val($.trim(row.PRate)).trigger("input");
            $('[id*="_ProductType"]').val($.trim(row.ProductType));
            $('[id*="SODetail_ProductType"]').val($.trim(row.ProductType));
            $('[id*="SODetail_Service"]').val($.trim(row.Service));
            $('[id*="_Service"]').val($.trim(row.Service));
            $('#Service').val($.trim(row.Service));
            $('#ProductDetailsId').val($.trim(row.ProductId)).trigger('input');

            if ($.trim(row.IMENo) === "No Barcode") {
                $('[id*="SODetail_Quantity"]').attr("readonly", false);
            } else {
                $('[id*="SODetail_Quantity"]').attr("readonly", true);
            }

            $('#ProductDetailsModal').modal('hide');
        });
    });
    </script>
