@using IMSWEB.Model
<div class="input-group">
    <input type="text" class="input-sm form-control input-sm" id="CustomersCode" name="CustomersCode" value="@ViewBag.CustomersCode" readonly="readonly">
    <span class="input-group-btn">
        <button type="button" id="CustomerPicker" class="btn btn-sm btn-info" onclick="LoadCustomers()"><i class="fa fa-plus-circle" aria-hidden="true"></i>&nbsp;Pick</button>
    </span>
    <input type="text" class="input-sm form-control input-sm" id="CustomersName" name="CustomersName" value="@ViewBag.CustomersName" readonly="readonly">
    <input type="hidden" class="input-sm form-control input-sm" id="CustomersId" name="CustomersId" value="@ViewBag.CustomersId" readonly="readonly">
    <input type="hidden" class="input-sm form-control input-sm" id="CustomerTypes" name="CustomerTypes" value="@ViewBag.CustomerTypes" readonly="readonly">
</div>

<!-- Modal -->
<div class="modal fade bs-example-modal-lg" id="CustomersModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h5 class="modal-title" id="myModalLabel">Existing Customers</h5>
            </div>
            <div class="modal-body">
                <div id="Customerstoolbar">
                </div>
                <table id="CustomersTable"
                       data-toolbar="#Customerstoolbar"
                       data-toggle="table"
                       data-search="true"
                       data-click-to-select="true"
                       data-single-select="true"
                       data-detail-view="true"
                       data-pagination="true"
                       data-id-field="name"
                       data-page-list="[10, 25, 50, 100, ALL]"
                       data-page-size="6"
                       class="table table-responsive table-bordered table-striped text-nowrap" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th data-field="Id" class="hidden">
                            </th>
                            <th data-field="CustomerTypes" class="hidden">
                            </th>
                            <th data-checkbox="true">
                            </th>
                            <th data-field="Code"
                                data-sortable="true">
                                Code
                            </th>
                            <th data-field="Name"
                                data-sorter="sorter"
                                data-sortable="true">
                                Name
                            </th>
                            <th data-field="ContactNo"
                                data-sorter="sorter"
                                data-sortable="true">
                                Contact No.
                            </th>
                            <th data-field="Address"
                                data-sorter="sorter"
                                data-sortable="true">
                                Address
                            </th>
                            <th data-field="TotalDue"
                                data-sorter="sorter"
                                data-sortable="true">
                                Retail Due
                            </th>
                            <th data-field="CreditDue"
                                data-sorter="sorter"
                                data-sortable="true">
                                Hire Due
                            </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    var $table = $('#CustomersTable');
    $(document).ready(function () {
        $('[id*="_CurrentDue"]').val(@ViewBag.CustomersCurrentDue);
        //$('[id*="_CurrentDue"]').trigger("input");

        var CustomerTypes = $('#CustomerTypes').val();
        if (CustomerTypes != "Dealer") {
            $('input[id*="_CashPaidAmount"]').attr("readonly", true);
        }
        else {
            $('input[id*="_CashPaidAmount"]').attr("readonly", false);
        }

    });
    $table.on('check.bs.table', function (e, row) {
        $('#CustomersCode').val($.trim(row.Code));
        $('#CustomersName').val($.trim(row.Name));
        $('#CustomerTypes').val($.trim(row.CustomerTypes));
        $('#CustomersId').val($.trim(row.Id)).trigger("input");
        $('[id*="CurrentDue"]').val($.trim(row.TotalDue));

        if ($.trim(row.CustomerTypes) == "Corporate") {
            $("#CustomerDocfile").show();
        }
        else {
            $("#CustomerDocfile").hide();
        }

        if ($.trim(row.CustomerTypes) != "Dealer") {
            $('input[id*="_CashPaidAmount"]').attr("readonly", true);
        }
        else {
            $('input[id*="_CashPaidAmount"]').attr("readonly", false);
        }

    });
    $table.on('uncheck.bs.table', function (e, row) {
        $('#CustomersCode').val('');
        $('#CustomersName').val('');
        $('#CustomerTypes').val('');
        $('#CustomersId').val('');
        $('[id*="CurrentDue"]').val('');
        $("#CustomerDocfile").hide();
        $('input[id*="_CashPaidAmount"]').attr("readonly", false);

    });

    function LoadCustomers() {
        $table.bootstrapTable('removeAll');
        var ConcernID = getDefaultIntIfEmpty($("#ConcernID").val());
        if (ConcernID == 0) {
            ConcernID = @User.Identity.GetConcernId()
        }

        $.ajax({
            method: "Get",
            url: "/Customer/GetCustomerByConcernID",
            contentType: "application/json, UTF-8",
            data: { "ConcernID": +ConcernID },
            success: function (data) {
                if (data.Result == true)
                    LoadTable(data.Data);
            },
            error: function (err) {
                console.error(err);
            }
        });
    }

    function LoadTable(data) {
        $table.bootstrapTable('load', data);
        $("#CustomersModal").modal("toggle");
    }

</script>
