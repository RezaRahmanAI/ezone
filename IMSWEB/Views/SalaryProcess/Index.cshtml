@using IMSWEB.Model
@model SalaryProcessViewModel
@{
    ViewBag.Title = "Salary Process";
    string actionName = ViewContext.RouteData.Values["action"].ToString();
    string controllerName = ViewContext.RouteData.Values["Controller"].ToString();
}

<h4 class="text-left inline-header">Salary Process Month: <span class="text-success">@Model.SalaryProcessMonth.ToString("MMMM yyyy")</span></h4>
<hr />
<div class="row">
    <div class="col-md-6 col-md-offset-3 ">
        <div class="panel panel-default">
            <div class="panel-body">
                @using (Html.BeginForm("ProcessSalary", controllerName, new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                {
                    <div class="form-group">
                        <label class="col-md-3">Employee</label>
                        <div class="col-md-9">
                            @{Html.RenderAction("RenderPicker", "Picker", new { pickerType = PickerType.MSEmployee, id = "0" });}
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-9 col-md-offset-3">
                            <label>
                                @Html.EditorFor(model => model.IsFestivalBonus)
                                @Html.LabelFor(model => model.IsFestivalBonus)
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-3">
                            <img id="spinningIcon" height="45" width="45" style="display: none;" class="pull-right" src="~/Content/images/Spinner.gif" />
                        </div>
                        <div class="col-md-9">
                            <input class="btn btn-info col-md-2 col-md-offset-3 btn-sm" type="submit" id="btnProcess" name="btnProcess" value="Process" />
                        </div>
                    </div>

                }
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="ErrorModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <p class="modal-title">Salary Process Error</p>
            </div>
            <div class="modal-body">
                <table id="ErrorTable"
                       data-toggle="table"
                       data-search="true"
                       data-show-refresh="true"
                       data-show-toggle="true"
                       data-show-columns="true"
                       data-show-export="true"
                       data-detail-view="true"
                       data-pagination="true"
                       data-id-field="name"
                       data-page-list="[10, 25, 50, 100, ALL]"
                       data-page-size="10"
                       class="table table-responsive table-bordered table-striped" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>
                                Sl
                            </th>
                            <th data-field="code"
                                data-sortable="true">
                                Code
                            </th>
                            <th data-field="name"
                                data-sorter="sorter"
                                data-sortable="true">
                                Employee
                            </th>
                            <th data-field="Error"
                                data-sorter="sorter"
                                data-sortable="true">
                                Error
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.ErrorList != null)
                        {
                            int count = 1;
                            foreach (var item in Model.ErrorList)
                            {
                                <tr>
                                    <td>
                                        @count
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Code)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Error)
                                    </td>
                                </tr>
                                count++;
                            }
                        }
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger btn-xs" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<script>

    $(document).ready(function () {
        @if(Model.ErrorList.Count()!=0)
        {
            @:$('#ErrorModal').modal('show');
        }

        $(document).on('submit', function () {
            $("#spinningIcon").show();
        });
    });

</script>